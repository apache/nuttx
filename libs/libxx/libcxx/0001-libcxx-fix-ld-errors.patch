--- libcxx/include/__ostream/basic_ostream.h
+++ libcxx/include/__ostream/basic_ostream.h
@@ -152,7 +152,11 @@

 template <class _CharT, class _Traits>
 basic_ostream<_CharT, _Traits>::sentry::~sentry() {
-  if (__os_.rdbuf() && __os_.good() && (__os_.flags() & ios_base::unitbuf) && !uncaught_exception()) {
+  if (__os_.rdbuf() && __os_.good() && (__os_.flags() & ios_base::unitbuf)
+#ifndef _LIBCPP_HAS_NO_EXCEPTIONS
+      && !uncaught_exception()
+#endif
+  ) {
 #ifndef _LIBCPP_HAS_NO_EXCEPTIONS
     try {
 #endif // _LIBCPP_HAS_NO_EXCEPTIONS
--- libcxx/src/exception.cpp
+++ libcxx/src/exception.cpp
@@ -19,6 +19,9 @@
 #if defined(_LIBCPP_ABI_MICROSOFT)
 #  include "support/runtime/exception_msvc.ipp"
 #  include "support/runtime/exception_pointer_msvc.ipp"
+#elif defined(_LIBCPPABI_VERSION) && defined(_LIBCPP_HAS_NO_EXCEPTIONS)
+#include "atomic_support.h"
+#include "support/runtime/exception_pointer_unimplemented.ipp"
 #elif defined(_LIBCPPABI_VERSION)
 #  include "support/runtime/exception_libcxxabi.ipp"
 #  include "support/runtime/exception_pointer_cxxabi.ipp"
